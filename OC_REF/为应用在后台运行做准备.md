【译】为避免撕逼，提前声明：本文纯属翻译，仅仅是为了学习，加上水平有限，见谅！

# 为应用在后台运行做准备
为应用挂起做准备

## 概述
当应用在后台运行的时候，它不会显示在屏幕上。当用户启动另一个应用或者返回主屏的时候，应用会从前台过渡到后台。也可以启动或者继续在后台运行应用来处理特殊事件。

### 处理失活应用
当应用从前台进入后台的时候，UIKit首先会调用`applicationWillResignActive:`方法让应用失活。当失活出现的时候，会执行以下操作。

* **把用户数据保存到磁盘并关闭任何打开的文件。**如果你的用户需要终止的时候，请始终保存用户数据。如果用户锁定设备的时候，关闭打开的文件。
* **只保存对用户至关重要的数据。**终止调度队列和操作队列，并且不能调度任何新的执行任务。
* **废弃任何激活过的定时器。**
* **终止游戏。**取消激活可以防止用户用户再与应用交互。

> **Note**
> 取消激活也可以发生在响应临时暂停的时候，例如呼入电话的时候。根据中断的类型和用户的操作，取消激活的应用可能会进入到后台或者重新激活。

### 过渡到后台执行
对于即将从前台进入到后台的应用，UIKit会调用应用委托的`applicationDidEnterBackground:`方法来把应用取消激活。这个方法标志着你的应用正在后台运行。当进入后台的时候，你可以在应用挂起之前采取一些额外的步骤。

* **清理应用的用户界面。**隐藏敏感信息，关闭警告和其他的临时界面，并准备好界面进行快照生成。
* **释放共享系统资源。**前台应用拥有使用像相机或者系统数据库等共享服务的优先权。当应用挂起的时候，如果应用持有任何共享资源，系统会将其终止。
* **取消相关的Bonjour服务。**从Bonjour移除注册并关闭任何使用在你的服务中的监听套接字。如果你的应用挂起的话，它就不会在响应任何请求了。
* **释放图片，媒体文件和临时对象。**把易重新创建或从磁盘中加载的内存占用多的对象引用移除。系统会自动清空系统管理缓存，包括由NSCache对象管理的数据和遵守NSdiscardableContent协议的对象。

在`applicationDidEnterBackground:`方法返回的某个时刻，UIKit会对应用当前的界面生成快照。在应用切换器中系统会使用这个快照图片并当应用返回到前台的时候，将其作为应用的启动屏幕。在应用委托方法中，通过从控制器中移除用户界面上的敏感信息保护用户隐私。当应用进入后台的时候，你可以决定是否立即展示这些信息或者首先请求用户授权。

> **Note**
> 对于支持保存和恢复状态的应用，当应用从前台进入后台的时候系统开始保存进程。详情请看Preserving Your App's UI Across Launches.

当在后台的时候，应用必须尽可能的保持最少的内存占用。如果应用管理大量的数据，你可能需要把数据写入到磁盘并把它从内存中释放。例如，如果应用操作图片数据，你要把数据保存到磁盘中这样你就可以把数据缓存释放掉了。耗费大量内存的后台应用会在内存占用小的应用之前释放。

## 话题
### 后台执行
---
#### 使用后台刷新更新应用
在后台适时的获取内容并更新应用界面。

#### 延长应用的后台执行时间
当应用进入后台的时候确保完成关键的任务。

#### 关于后台执行顺序
当应用进入后台的时候，了解你自定义代码的执行顺序。


